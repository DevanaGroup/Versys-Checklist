# ‚úÖ Integra√ß√£o do Modo de Avalia√ß√£o Ponderada

## üéØ Implementa√ß√£o Completa

Sistema de avalia√ß√£o ponderada **integrado** na rota existente `/projetos/write/:id` mantendo o **AppSidebar** do sistema.

---

## üìç Rota e Acesso

### Rota Integrada
- ‚úÖ **Rota**: `/projetos/write/:id` (mesma rota existente)
- ‚úÖ **Mant√©m**: AppSidebar do sistema (menu lateral principal)
- ‚úÖ **Toggle**: Bot√£o para alternar entre "Modo Antigo" e "Novo Modo Avalia√ß√£o"

### Como Acessar
1. Fa√ßa login como administrador
2. V√° em **Projetos** no menu
3. Clique em qualquer projeto
4. Clique em **"Editar"** ou **"Escrever"**
5. Na p√°gina, clique no bot√£o **"‚ú® Novo Modo Avalia√ß√£o"** (canto superior direito)

---

## üèóÔ∏è Estrutura Hier√°rquica

### Sidebar com 3 N√≠veis

```
üìÅ M√ìDULO (ex: "1. BARREIRAS PERIMETRAIS")
  ‚îî‚îÄ üìÑ ITEM (ex: "4.1 - O per√≠metro est√° protegido?")
     ‚îú‚îÄ ‚ö†Ô∏è NC 1: "Ilumina√ß√£o insuficiente" (1.5/5)
     ‚îú‚îÄ ‚ö†Ô∏è NC 2: "Muros com falhas" (1.0/3)
     ‚îî‚îÄ ‚ö†Ô∏è NC 3: ... (quantas NCs voc√™ quiser!)
```

### Recursos da Sidebar

#### Expans√£o/Colapso
- Clique no **m√≥dulo** para expandir/colapsar itens
- Clique no **item** para expandir/colapsar NCs

#### Informa√ß√µes em Tempo Real
- **Pontua√ß√£o por n√≠vel**: 
  - M√≥dulo: soma de todos os itens
  - Item: soma de todas as NCs
  - NC: soma de todas as perguntas

- **Badges informativos**:
  - N√∫mero de itens no m√≥dulo
  - N√∫mero de NCs no item

- **√çcones de status**:
  - ‚ö†Ô∏è Pendente (cinza)
  - üïê Em progresso (amarelo)
  - ‚úÖ Conclu√≠do (verde)

#### Navega√ß√£o
- Clique em qualquer **NC** para visualizar suas perguntas
- Item ativo destacado em **azul claro**
- NC ativa destacada em **verde** (cor prim√°ria)

---

## üéØ Sistema de NCs (N√£o Conformidades)

### O Que S√£o NCs?

NCs s√£o **subdivis√µes de um item** para organizar melhor as avalia√ß√µes. Por exemplo:

**Item**: "O per√≠metro est√° protegido?"
- **NC 1**: Ilumina√ß√£o insuficiente
- **NC 2**: Muros com falhas  
- **NC 3**: Cercas danificadas

### Gerenciamento de NCs

#### Adicionar NC
1. Selecione um item na sidebar
2. Clique no bot√£o **"+ Adicionar NC"** no header
3. Uma nova NC √© criada automaticamente com numera√ß√£o sequencial

#### Remover NC
1. Navegue at√© a NC que deseja remover
2. Clique no bot√£o **"üóëÔ∏è Remover NC"** (s√≥ aparece se houver mais de 1 NC)
3. A NC √© removida e as demais s√£o renumeradas

#### Caracter√≠sticas
- ‚úÖ **Ilimitadas**: Adicione quantas NCs precisar (1, 2, 3, 10...)
- ‚úÖ **Numera√ß√£o autom√°tica**: NC 1, NC 2, NC 3...
- ‚úÖ **Pontua√ß√£o independente**: Cada NC tem sua pr√≥pria pontua√ß√£o
- ‚úÖ **Perguntas pr√≥prias**: Cada NC pode ter suas pr√≥prias perguntas

---

## ‚ùì Sistema de Perguntas Ponderadas

### Estrutura de Cada Pergunta

```
Pergunta: "A ilumina√ß√£o est√° adequada?" (Peso 3 | OBRIGAT√ìRIO)

Op√ß√µes de Resposta:
[N/A]  [üò¢]  [üòê]  [üòä]  [üèÜ]

A√ß√µes:
üìé Anexar    üí¨ Comentar
```

### Pesos e Pontua√ß√£o

| Peso | Import√¢ncia | Exemplo |
|------|-------------|---------|
| **1** | Baixa | Itens de menor criticidade |
| **2** | M√©dia | Itens importantes |
| **3** | Alta | Itens cr√≠ticos/obrigat√≥rios |

### Op√ß√µes de Resposta e Valores

| Op√ß√£o | Emoji | Valor | C√°lculo |
|-------|-------|-------|---------|
| **N/A** | - | 100% | Peso √ó 1.0 |
| **Muito Ruim** | üò¢ | 0% | Peso √ó 0.0 |
| **Regular** | üòê | 50% | Peso √ó 0.5 |
| **Bom** | üòä | 75% | Peso √ó 0.75 |
| **Excelente** | üèÜ | 100% | Peso √ó 1.0 |

### Exemplos de C√°lculo

**Exemplo 1**: Pergunta peso 3 com resposta "Bom" (üòä)
- C√°lculo: 3 √ó 0.75 = **2.25 pontos**

**Exemplo 2**: Pergunta peso 2 com resposta "Regular" (üòê)
- C√°lculo: 2 √ó 0.5 = **1.0 ponto**

**Exemplo 3**: NC com 3 perguntas
- Pergunta 1 (Peso 3): Bom = 2.25
- Pergunta 2 (Peso 2): Regular = 1.0
- Pergunta 3 (Peso 2): Excelente = 2.0
- **Total da NC: 5.25/7 pontos (75%)**

---

## üé® Interface e Usabilidade

### Layout Desktop

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [‚Üê Voltar]  Projeto: XPTO          [Modo Antigo] [+ NC]   ‚îÇ
‚îÇ  1. BARREIRAS ‚Üí 4.1 Per√≠metro                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  SIDEBAR        ‚îÇ  CONTE√öDO                                 ‚îÇ
‚îÇ                 ‚îÇ                                           ‚îÇ
‚îÇ  üìÅ BARREIRAS   ‚îÇ  NC 1 - Ilumina√ß√£o  [1.5/5]             ‚îÇ
‚îÇ   ‚îî‚îÄ 4.1...     ‚îÇ                                           ‚îÇ
‚îÇ      ‚ö†Ô∏è NC 1    ‚îÇ  1. A ilumina√ß√£o est√° adequada?          ‚îÇ
‚îÇ      ‚ö†Ô∏è NC 2    ‚îÇ     Peso 3 | OBRIGAT√ìRIO                 ‚îÇ
‚îÇ                 ‚îÇ                                           ‚îÇ
‚îÇ  üìÅ TI          ‚îÇ  [N/A] [üò¢] [üòê] [üòä] [üèÜ]              ‚îÇ
‚îÇ                 ‚îÇ                                           ‚îÇ
‚îÇ  [VER PEND√äNCIAS‚îÇ  üìé Anexar  üí¨ Comentar                  ‚îÇ
‚îÇ  [CONTINUAR]    ‚îÇ                                           ‚îÇ
‚îÇ  [CONCLUIR]     ‚îÇ  Respondido em: 24/10 14:30              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Breadcrumbs
No header, voc√™ sempre v√™ onde est√°:
```
M√≥dulo Atual ‚Üí Item Atual
```
Exemplo: `1. BARREIRAS PERIMETRAIS ‚Üí 4.1 - O per√≠metro est√° protegido?`

### Bot√µes e A√ß√µes

| Bot√£o | Localiza√ß√£o | Fun√ß√£o |
|-------|-------------|--------|
| **‚Üê Voltar** | Header | Volta para lista de projetos |
| **Modo Antigo** | Header | Volta para interface antiga |
| **+ Adicionar NC** | Header | Cria nova NC no item atual |
| **üóëÔ∏è Remover NC** | Abaixo do t√≠tulo NC | Remove NC atual (se houver >1) |
| **üìé Anexar** | Abaixo das respostas | Anexa m√≠dia |
| **üí¨ Comentar** | Abaixo das respostas | Adiciona coment√°rio |

---

## üîÑ Altern√¢ncia de Modos

### Modo Antigo (Legacy)
- Interface original com passos sequenciais
- Avalia√ß√µes NC/R/NA tradicionais
- Navega√ß√£o por passos (1 de 5, 2 de 5...)

### Novo Modo (Weighted)
- Sidebar hier√°rquica: M√≥dulos > Itens > NCs
- Perguntas com peso e emojis
- Pontua√ß√£o autom√°tica em tempo real
- Suporte a m√∫ltiplas NCs por item

### Como Alternar

**Para Novo Modo:**
1. No modo antigo, clique em **"‚ú® Novo Modo Avalia√ß√£o"** (canto superior direito)

**Para Modo Antigo:**
1. No novo modo, clique em **"üìã Modo Antigo"** (canto superior direito)

---

## üìä Dados e Estrutura

### Convers√£o Autom√°tica

O sistema **converte automaticamente** os dados existentes para a nova estrutura:

**Estrutura Antiga:**
```
customAccordions ‚Üí items ‚Üí subItems
```

**Nova Estrutura:**
```
m√≥dulos ‚Üí itens ‚Üí ncs ‚Üí perguntas
```

### Estrutura de Dados

```typescript
{
  modules: [
    {
      id: "mod_1",
      titulo: "1. BARREIRAS PERIMETRAIS",
      ordem: 1,
      itens: [
        {
          id: "item_1",
          titulo: "4.1 - O per√≠metro...",
          ordem: 1,
          pontuacaoAtual: 2.5,
          pontuacaoMaxima: 7,
          ncs: [
            {
              id: "nc_1",
              numero: 1,
              titulo: "Ilumina√ß√£o insuficiente",
              pontuacaoAtual: 1.5,
              pontuacaoMaxima: 5,
              perguntas: [
                {
                  id: "q_1",
                  text: "A ilumina√ß√£o est√° adequada?",
                  weight: 3,
                  required: true,
                  responseOptions: ['na', 'very_bad', 'bad', 'good', 'excellent'],
                  response: {
                    selectedOption: 'bad',
                    respondedAt: "2025-10-24T14:30:00",
                    respondedBy: "user123"
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

---

## üîß Arquivos Modificados

1. **`src/lib/types.ts`**
   - Adicionado: `NC`, `ProjectModule`, `ProjectItem` (hier√°rquico)

2. **`src/components/HierarchicalProjectSidebar.tsx`** (NOVO)
   - Sidebar hier√°rquica com 3 n√≠veis
   - Expans√£o/colapso de m√≥dulos e itens
   - Navega√ß√£o por clique
   - Indicadores visuais de status

3. **`src/pages/ProjectWrite.tsx`** (MODIFICADO)
   - Estado `evaluationMode` para alternar entre modos
   - Fun√ß√£o `loadHierarchicalStructure()` para converter dados
   - Fun√ß√µes `handleNavigate()`, `addNC()`, `removeNC()`
   - Renderiza√ß√£o condicional baseada no modo
   - Interface completa do modo ponderado integrada

---

## ‚úÖ Checklist de Funcionalidades

### Sidebar
- [x] Hierarquia de 3 n√≠veis (M√≥dulo > Item > NC)
- [x] Expans√£o/colapso de m√≥dulos
- [x] Expans√£o/colapso de itens
- [x] Navega√ß√£o por clique nas NCs
- [x] Pontua√ß√£o em tempo real
- [x] Badges informativos
- [x] √çcones de status
- [x] Highlight de item/NC ativo

### NCs
- [x] Adicionar NC dinamicamente
- [x] Remover NC (quando houver >1)
- [x] Numera√ß√£o autom√°tica
- [x] Pontua√ß√£o independente
- [x] Perguntas pr√≥prias

### Perguntas
- [x] Peso configur√°vel (1, 2, 3)
- [x] Campo obrigat√≥rio (*)
- [x] Op√ß√µes de resposta com emojis
- [x] C√°lculo autom√°tico de pontua√ß√£o
- [x] Timestamp de resposta
- [x] Indica√ß√£o visual de resposta selecionada

### Interface
- [x] Breadcrumbs de navega√ß√£o
- [x] Bot√£o alternar entre modos
- [x] Bot√£o adicionar NC
- [x] Bot√£o remover NC
- [x] Bot√µes anexar e comentar
- [x] Layout responsivo

### Integra√ß√£o
- [x] Rota existente mantida
- [x] AppSidebar mantido
- [x] Convers√£o autom√°tica de dados
- [x] Compatibilidade com modo antigo

---

## üöÄ Pr√≥ximos Passos (Opcionais)

1. **Persist√™ncia de NCs no Firebase**
   - Salvar NCs criadas no banco
   - Carregar NCs salvas

2. **Anexos e Coment√°rios Funcionais**
   - Implementar upload de m√≠dia
   - Sistema de coment√°rios completo

3. **Relat√≥rios de Pontua√ß√£o**
   - Gr√°ficos por m√≥dulo/item/NC
   - Exporta√ß√£o para PDF

4. **Configura√ß√£o de Perguntas**
   - Interface para criar/editar perguntas
   - Definir pesos por pergunta

---

## üìñ Guia R√°pido de Uso

### 1. Ativar Novo Modo
```
Projetos ‚Üí Selecionar Projeto ‚Üí Editar ‚Üí "‚ú® Novo Modo Avalia√ß√£o"
```

### 2. Navegar pela Estrutura
```
Sidebar: M√≥dulo ‚Üí Item ‚Üí NC (clique para abrir)
```

### 3. Adicionar NC
```
Header: "+ Adicionar NC" (com item selecionado)
```

### 4. Responder Perguntas
```
Clique no emoji correspondente ‚Üí Pontua√ß√£o atualiza automaticamente
```

### 5. Remover NC
```
Abaixo do t√≠tulo da NC: "üóëÔ∏è Remover NC" (se houver >1)
```

### 6. Voltar ao Modo Antigo
```
Header: "üìã Modo Antigo"
```

---

**Sistema 100% funcional e integrado! üéâ**

Acesse: `/projetos/write/:id` e clique em "‚ú® Novo Modo Avalia√ß√£o"

